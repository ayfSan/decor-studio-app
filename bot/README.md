# Telegram Bot для 2D Decor Studio

Этот бот позволяет пользователям получать уведомления о событиях и задачах, а также быстро входить в веб-приложение.

## Настройка

### 1. Создание бота в Telegram

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 2. Настройка переменных окружения

Создайте файл `.env` в папке `bot` со следующими переменными:

```env
BOT_TOKEN=your_telegram_bot_token_here
WEBAPP_URL=https://your-app-url.onrender.com
API_URL=https://your-app-url.onrender.com/api
```

### 3. Настройка базы данных

Выполните SQL скрипт `add_telegram_fields.sql` в вашей базе данных для добавления необходимых полей:

```sql
-- Добавление полей для привязки Telegram аккаунта
USE `a1142004_2d_decorstudio`;

-- Добавляем поля для кода привязки и времени его истечения
ALTER TABLE `user`
ADD COLUMN `telegram_link_code` VARCHAR(10) NULL,
ADD COLUMN `telegram_link_code_expires_at` DATETIME NULL;

-- Добавляем индекс для быстрого поиска по коду
CREATE INDEX `idx_telegram_link_code` ON `user` (`telegram_link_code`);
```

### 4. Запуск бота

```bash
cd bot
npm install
node index.cjs
```

## Функциональность

### Команды бота

- `/start` - Начать работу с ботом
- `/app` - Открыть веб-приложение
- `/add` - Добавить доход или расход
- `/login` - Быстрый вход в веб-приложение
- `/link <КОД>` - Привязать Telegram-аккаунт

### Привязка аккаунта

1. Пользователь заходит в настройки веб-приложения
2. Нажимает "Получить код для привязки"
3. Копирует 6-значный код
4. Отправляет код боту командой `/link КОД`
5. Аккаунт привязывается

### Быстрый вход

1. Пользователь отправляет команду `/login` боту
2. Бот генерирует временную ссылку для входа
3. Пользователь переходит по ссылке и автоматически входит в приложение

## Структура файлов

- `index.cjs` - Основной файл бота
- `logger.cjs` - Система логирования
- `bot-commands.txt` - Описание команд
- `logs/` - Папка с логами

## Безопасность

- Все токены хранятся в переменных окружения
- Коды привязки действительны 5 минут
- Токены входа действительны 2 минуты
- Все токены удаляются после использования
